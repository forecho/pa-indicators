# PA Indicators

一个用于 TradingView 的 Price Action 综合指标，集成了 IBS K线着色、区间震荡检测、L/H 摆动点标记、开盘提示、K线计数器和缺口检测等功能。

## 功能特性

### 1. IBS K线着色

**IBS (Internal Bar Strength)** 通过颜色深浅直观展示每根 K 线的内部强度。

#### 计算公式

```
IBS = (收盘价 - 最低价) / (最高价 - 最低价) × 100
```

#### 着色逻辑

| K线类型 | IBS 值 | 含义 | 颜色效果 |
|--------|--------|-----|---------|
| **阳线** | > 69 | 收盘接近高点，买压强 | 🟢 实色绿（强势上涨）|
| **阳线** | 31-69 | 收盘在中间 | 🟢 普通绿（30% 透明）|
| **阳线** | < 31 | 收盘接近低点，有压力 | 🟢 淡绿（85% 透明）|
| **阴线** | < 31 | 收盘接近低点，卖压强 | 🔴 实色红（强势下跌）|
| **阴线** | 31-69 | 收盘在中间 | 🔴 普通红（30% 透明）|
| **阴线** | > 69 | 收盘接近高点，有支撑 | 🔴 淡红（85% 透明）|

**简单记忆**：
- 阳线收盘越接近高点 = 上涨越强势 = 颜色越实
- 阴线收盘越接近低点 = 下跌越强势 = 颜色越实

### 2. 区间震荡检测

当 K 线的**上影线或下影线超过 50%**（可调节）时，显示为 🔵 **蓝色**，表示市场进入震荡区间。

**应用场景**：
- 趋势 K 线（实色）：收盘接近高点/低点，表明趋势明确
- 区间 K 线（蓝色）：带有明显影线，表明多空争夺激烈

### 3. EMA 均线

| 均线 | 默认周期 | 颜色 | 用途 |
|-----|---------|-----|------|
| EMA20 | 20 | 🟢 绿色 | 短期趋势 |
| EMA240 | 240 | 🟡 黄色 | 中长期趋势 |

### 4. K线计数器

在 RTH（常规交易时段）显示 K 线编号，方便追踪交易时段内的 K 线位置。

**设置选项**：
- RTH 时段：默认 09:30-16:15（美东时间）
- 间隔计数：只显示奇数编号，减少图表杂乱
- 文字大小/颜色：可自定义

**适用周期**：5 分钟 ~ 60 分钟

### 5. L/H 摆动点标记

根据趋势自动标记摆动高低点，带编号显示（L1, L2, H1, H2...），帮助识别潜在的入场机会。

#### 核心逻辑

| 趋势 | 标记 | 含义 |
|-----|------|-----|
| 🟢 上升趋势 | **L1, L2, L3...** | 第1个、第2个、第3个回调低点（潜在买入机会）|
| 🔴 下降趋势 | **H1, H2, H3...** | 第1个、第2个、第3个反弹高点（潜在卖出机会）|

#### 创新高/新低重置计数

```
上升趋势中：
  价格创新高 → L 计数重置为 0
  下一个摆动低点 → 标记为 L1

下降趋势中：
  价格创新低 → H 计数重置为 0
  下一个摆动高点 → 标记为 H1
```

**示例**：上升趋势中出现 L1 → L2 → 创新高 → L1（重新开始）

#### 信号K vs 入场K

**当前标记的是「信号K」**（已确认的摆动点），使用 `ta.pivothigh/pivotlow` 检测：

```
摆动周期=3 的情况：

        H ← 这里标记
       /\
      /  \
     /    \  ← 需要右边3根K线确认后才显示
    /      \
```

| 特性 | 说明 |
|-----|------|
| ✅ 优点 | 标记准确，假信号少 |
| ⚠️ 延迟 | 有 `摆动周期` 根 K 线的确认延迟 |
| 💡 建议 | 如需更快响应，可将摆动周期设为 1-2，但假信号会增多 |

#### 趋势判断方式

| 方式 | 上升趋势 | 下降趋势 |
|-----|---------|---------|
| EMA20 | 收盘价 > EMA20 | 收盘价 < EMA20 |
| EMA20/240 | EMA20 > EMA240 | EMA20 < EMA240 |

### 6. 开盘提示（右上角）

在图表右上角显示今日开盘状态和对应的交易策略提示。

#### 高开时显示

```
⬆️ 高开 0.52%
📈 双底(EMA附近) → 继续向上
📈 楔形底(EMA附近) → 继续向上
📉 双顶 → 向下反转
📉 楔形顶 → 向下反转
```

#### 低开时显示

```
⬇️ 低开 0.35%
📉 双顶(EMA附近) → 继续向下
📉 楔形顶(EMA附近) → 继续向下
📈 双底 → 向上反转
📈 楔形底 → 向上反转
```

#### 四种核心形态说明

| 开盘 | 形态 | 位置 | 方向 |
|-----|------|-----|------|
| **高开** | 双底/楔形底 | EMA附近 | 📈 继续向上 |
| **高开** | 双顶/楔形顶 | - | 📉 向下反转 |
| **低开** | 双顶/楔形顶 | EMA附近 | 📉 继续向下 |
| **低开** | 双底/楔形底 | - | 📈 向上反转 |

### 7. 缺口检测

自动检测并标记价格缺口，缺口被回补后自动删除。

| 缺口类型 | 颜色 | 说明 |
|---------|-----|------|
| 向上跳空 | 🟢 绿色（40% 透明）| 当前 K 线低点 > 前一根高点 |
| 向下跳空 | 🔴 红色（40% 透明）| 当前 K 线高点 < 前一根低点 |
| 测量型缺口 | 更淡（70% 透明）| 跨越 2 根 K 线的大缺口 |

## 参数设置

### EMA 设置
- `EMA20`：短期均线周期（默认 20）
- `EMA240`：长期均线周期（默认 240）

### K线计数器设置
- `K线计数`：是否显示计数
- `间隔计数`：只显示奇数编号
- `RTH(美东时间)`：交易时段（默认 09:30-16:15）
- `文字大小`：tiny / small / normal / large
- `文字颜色`：自定义颜色

### IBS 颜色设置
- `阳线基础颜色`：默认 #26A69A（青绿）
- `阴线基础颜色`：默认 #EF5350（红色）
- `区间震荡颜色`：默认蓝色
- `影线阈值(%)`：超过此值显示为区间震荡（默认 50%）

### L/H 标记设置
- `启用 L/H 标记`：开关标记功能
- `摆动周期`：检测高低点的左右 K 线数量（默认 3）
- `文字大小`：tiny / small / normal / large
- `L 颜色`：低点标记颜色（默认绿色）
- `H 颜色`：高点标记颜色（默认红色）
- `趋势判断`：EMA20 或 EMA20/240

### 开盘提示设置
- `显示开盘提示`：开关右上角提示
- `跳空阈值(%)`：高开/低开的判定阈值（默认 0.3%）

### 缺口检测设置
- `启用缺口检测`：开关缺口检测功能

## 使用建议

1. **趋势判断**：观察 K 线颜色深浅
   - 连续实色 K 线 = 强趋势
   - 连续淡色或蓝色 K 线 = 震荡/整理

2. **入场时机**：
   - 强势 K 线（实色）后的回调可能是顺势入场点
   - 蓝色 K 线连续出现时谨慎追涨杀跌

3. **开盘策略**（右上角提示）：
   - **高开** 时关注 EMA 附近的双底/楔形底形态 → 做多
   - **高开** 出现双顶/楔形顶 → 警惕反转做空
   - **低开** 时关注 EMA 附近的双顶/楔形顶形态 → 做空
   - **低开** 出现双底/楔形底 → 警惕反转做多

4. **L/H 标记交易**：
   - **L1** 通常是最佳买入机会（第一次回调）
   - **L2、L3** 风险逐渐增加，趋势可能接近尾声
   - 创新高后的 **L1** 是趋势延续的信号
   - **H1、H2** 同理，用于下降趋势中的做空

5. **缺口交易**：
   - 未回补的缺口可能成为支撑/阻力
   - 测量型缺口（更淡）通常意义更大

## 安装方法

1. 在 TradingView 中打开 Pine Editor
2. 复制 `PA_Indicators.pine` 的全部代码
3. 点击「添加到图表」

## License

MIT

